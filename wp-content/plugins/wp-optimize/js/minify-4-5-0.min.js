!function(e){function t(t){var n=e(t).serializeArray().reduce(i,{});return e(t).find('input[type="checkbox"]').each(function(t){var i=e(this).prop("name");if(i.includes("[]")){if(!e(this).is(":checked"))return;var s=i.replace("[]","");n[s]||(n[s]=[]),n[s].push(e(this).val())}else n[i]=e(this).is(":checked")?"true":"false"}),n}function i(e,t){return t.name.includes("[]")?e:(e[t.name]=t.value,e)}var n=window.wp_optimize||{},s=n.block_ui,a=n.send_command,o=wpoptimize.refresh_frequency||3e4,c=WP_Optimize_Heartbeat(),p=[];if(!a)return void console.error("WP-Optimize Minify: wp_optimize.send_command is required.");var l={};l.init=function(){function i(t){var i=t.data("tabname"),n="#wpo_section_"+i,s=t.is(":checked"),a=e(t.is("#wpo_min_enable_minify_js")?n+" .show-if-enabled":n);e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="'+i+'"] span.disabled').toggleClass("hidden",s),a.toggleClass("wpo-disabled-section",!s)}function o(){e("#wp-optimize-nav-tab-wpo_minify-font-contents .google_fonts_option:not(.skip-disable-processing)").prop("disabled",z.is(":checked"))}function l(t,i,s){var o=e(".wpo_section_notice_"+t);o.length&&a("toggle_minify_notice",{type:t,merging_enabled:i,force_hide:s},function(e){e.hasOwnProperty("success")&&e.success===!0&&(e.hasOwnProperty("hide")&&e.hide===!0&&o.stop(!0,!0).slideUp(300),e.hasOwnProperty("hide")&&e.hide===!1&&o.stop(!0,!0).slideDown(300)),e.hasOwnProperty("message")&&e.success!==!0&&n.notices.show_notice("error",e.message)})}function r(e){return e.data("url")}function d(t){var i=e("#exclude_js"),n=i.val();n+=t+"\n",i.val(n)}function _(t){var i=e("#exclude_css"),n=i.val();n+=t+"\n",i.val(n)}function f(t){var i=t.data("url"),n=e("#async_js"),s=n.val();s+=i+"\n",n.val(s),m("js"),h(t)}function u(t){var i=t.data("url"),n=e("#async_css"),s=n.val();s+=i+"\n",n.val(s),m("css"),h(t)}function m(t){e("#wp-optimize-nav-tab-wpo_minify-"+t+"-contents form").data("need_saving",!0)}function h(t){t.closest(".wpo_min_log").prev().removeClass("hidden").addClass("updated").slideDown(),t.text(wpoptimize.added_to_list),t.removeClass("exclude"),t.parent().addClass("disable-list-item"),t.replaceWith(e("<span>"+t.text()+"</span>"))}function w(t){e('input[name="enable_defer_js"]').each(function(t,i){e(i).closest("fieldset").removeClass("selected").find(".defer-js-settings").slideUp("fast")}),e('input[name="enable_defer_js"]:checked').closest("fieldset").addClass("selected").find(".defer-js-settings").slideDown("fast")}function g(){var e=c.add_agent({command:"get_minify_preload_status",callback:v,_keep:!1});null!==e&&p.push(e)}function v(e){e.done?(k.val(wpoptimize.run_now),k.data("running",!1)):(k.val(wpoptimize.cancel),k.data("running",!0),g()),j.text(e.message),y(e)}function y(t){e("#wpo_min_cache_size").text(t.size),e("#wpo_min_cache_total_size").text(t.total_size)}var b=this;this.enabled=!1,e(document).on("wp-optimize/minify/toggle-status",function(t,i){i.hasOwnProperty("enabled")&&(e('[data-whichpage="wpo_minify"]').toggleClass("is-enabled",i.enabled),b.enabled=i.enabled,b.enabled&&b.getFiles())}),e(".purge_minify_cache").on("click",function(t){t.preventDefault(),s(wpoptimize.clearing_cache),a("purge_minify_cache",null,function(e){e.hasOwnProperty("files")&&(b.updateFilesLists(e.files),b.updateStats(e.files))}).always(function(){e.unblockUI()})}),e(".purge_all_minify_cache").on("click",function(){s(wpoptimize.clearing_cache),a("purge_all_minify_cache",null,function(e){e.hasOwnProperty("files")&&(b.updateFilesLists(e.files),b.updateStats(e.files))}).always(function(){e.unblockUI()})}),e(".minify_increment_cache").on("click",function(){s(wpoptimize.creating_cache),a("minify_increment_cache",null,function(e){e.hasOwnProperty("files")&&(b.updateFilesLists(e.files),b.updateStats(e.files))}).always(function(){e.unblockUI()})}),e("#wp-optimize-nav-tab-wpo_minify-status-contents form :input, #wp-optimize-nav-tab-wpo_minify-js-contents form :input, #wp-optimize-nav-tab-wpo_minify-css-contents form :input, #wp-optimize-nav-tab-wpo_minify-font-contents form :input, #wp-optimize-nav-tab-wpo_minify-analytics-contents form :input, #wp-optimize-nav-tab-wpo_minify-settings-contents form :input, #wp-optimize-nav-tab-wpo_minify-advanced-contents form :input").on("change",function(){e(this).closest("form").data("need_saving",!0)}),e("input[type=checkbox].wpo-save-setting").on("change",function(t){var i=e(this),n=i.prop("checked"),o=i.prop("name"),c={};c[o]=n,s(wpoptimize.saving),a("save_minify_settings",c,function(e){e.success?(i.trigger("wp-optimize/minify/saved_setting"),e.hasOwnProperty("files")&&(b.updateFilesLists(e.files),b.updateStats(e.files))):console.log("Settings not saved",c)}).always(function(){e.unblockUI()})}),e("#wpo_min_enable_minify").on("wp-optimize/minify/saved_setting",function(){this.enabled=e(this).prop("checked"),e(document).trigger("wp-optimize/minify/toggle-status",{enabled:this.enabled})}),e("#wpo_min_enable_minify").on("wp-optimize/minify/saved_setting",function(){e(this).closest(".wpo_section").toggleClass("wpo-feature-is-disabled",!e(this).is(":checked"))}),e("#wpo_min_enable_minify_css, #wpo_min_enable_minify_js").on("wp-optimize/minify/saved_setting",function(){i(e(this))}).each(function(){i(e(this))}),e("#wpo_min_enable_minify_debug").on("wp-optimize/minify/saved_setting",function(){s(wpoptimize.page_refresh),location.href=e("#wp-optimize-nav-tab-wpo_minify-advanced").prop("href")}),e("#wpo_min_edit_default_exclutions").on("wp-optimize/minify/saved_setting",function(){e(".wpo-minify-default-exclusions").toggleClass("hidden",!e(this).prop("checked"))});var z=e("#disable_google_fonts_processing");z.on("change",o),o(),e(".wp-optimize-save-minify-settings").on("click",function(i){i.preventDefault();var o=e(this),c=o.next(),p=c.next();c.show(),s(wpoptimize.saving);var r={},d={js:null,css:null},_=e('[data-whichpage="wpo_minify"] .wp-optimize-nav-tab-contents form');_.each(function(){var i=e(this);!0===i.data("need_saving")&&(r=Object.assign(r,t(i)),i.data("need_saving",!1),"undefined"!=typeof r.enable_merging_of_js&&(d.js="true"===r.enable_merging_of_js),"undefined"!=typeof r.enable_merging_of_css&&(d.css="true"===r.enable_merging_of_css))}),a("save_minify_settings",r,function(t){t.hasOwnProperty("error")?(console.log(t.error),n.notices.show_notice(t.success,t.error)):e(".wpo-error__enabling-cache").addClass("wpo_hidden").find("p").text(""),t.hasOwnProperty("files")&&(b.updateFilesLists(t.files),b.updateStats(t.files)),e.each(d,function(e,t){null!==t&&l(e,t,!1)}),c.hide(),p.show(),setTimeout(function(){p.fadeOut("slow",function(){p.hide()})},5e3)}).always(function(){e.unblockUI()})}),e(".wpo_section_notice_minify").on("click",".notice-dismiss",function(e){e.preventDefault(),l("minify",null,!0)}),e(".wpo_section_notice_js").on("click",".notice-dismiss",function(e){e.preventDefault(),l("js",null,!0)}),e(".wpo_section_notice_css").on("click",".notice-dismiss",function(e){e.preventDefault(),l("css",null,!0)}),e("#wpo_min_jsprocessed, #wpo_min_cssprocessed").on("click",".log",function(t){t.preventDefault(),e(this).nextAll(".wpo_min_log").slideToggle("fast");var i=e(this).text().trim();wpoptimize.show_information===i?e(this).text(wpoptimize.hide_information):e(this).text(wpoptimize.show_information)}),e("#wpo_min_jsprocessed, #wpo_min_cssprocessed").on("click",".delete-file",function(t){t.preventDefault();var i=e(this).data("filename");return""===i||void 0===i?(alert(wpoptimize.cache_file_not_found),!1):(s(wpoptimize.deleting),void a("delete_minify_cache_file",i,function(e){""!==e.files&&(b.updateFilesLists(e.files),b.updateStats(e.files)),""!==e.result&&alert(e.result),""!==e.error&&alert(e.error)}).always(function(){e.unblockUI()}))}),e("#wpo_min_jsprocessed").on("click",".exclude",function(t){t.preventDefault();var i=e(this),n=r(i);d(n),m("js"),h(i)}),e("#wpo_min_cssprocessed").on("click",".exclude",function(t){t.preventDefault();var i=e(this),n=r(i);_(n),m("css"),h(i)}),e(".wpo-minify-download-metas-button").on("click",function(e){e.preventDefault(),a("get_minify_meta_files",null,function(e){if(e.hasOwnProperty("error"))return void alert(e.error);var t=document.body.appendChild(document.createElement("a"));t.setAttribute("download","combined_metas.json"),t.setAttribute("style","display:none;"),t.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(e.combined_metas))),t.click()})}),e("#wpo_min_jsprocessed").on("click",".defer",function(t){t.preventDefault(),f(e(this))}),e("#wpo_min_cssprocessed").on("click",".async",function(t){t.preventDefault(),u(e(this))}),e("#wp-optimize-minify-advanced").on("click",".save-exclusions",function(t){t.preventDefault(),e(".wp-optimize-save-minify-settings").first().trigger("click")}),this.enabled=e("#wpo_min_enable_minify").prop("checked"),e(document).trigger("wp-optimize/minify/toggle-status",{enabled:this.enabled}),this.enabled||e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="status"]').is(".nav-tab-active")||e('#wp-optimize-nav-tab-wrapper__wpo_minify a[data-tab="status"]').trigger("click"),e('input[name="enable_defer_js"]').on("change",w),w();var k=e("#wp_optimize_run_minify_preload"),j=e("#wp_optimize_preload_minify_status");k.on("click",function(){var t=e(this),i=t.data("running"),n=j.text();t.prop("disabled",!0),i?(t.data("running",!1),c.cancel_agents(p),a("cancel_minify_preload",null,function(e){e&&e.hasOwnProperty("message")&&j.text(e.message)}).always(function(){t.val(wpoptimize.run_now),t.prop("disabled",!1)})):(j.text(wpoptimize.starting_preload),t.data("running",!0),a("run_minify_preload",null,null,!0,{timeout:3e3}).always(function(e){try{var i=wpo_parse_json(e)}catch(s){}if(i&&i.error){var a=wpoptimize.error_unexpected_response;return"function"!=typeof i.error?a=i.error:i.status&&(a=i.status+": "+i.statusText),alert(a),j.text(n),t.prop("disabled",!1),void t.data("running",!1)}j.text(wpoptimize.loading_urls),t.val(wpoptimize.cancel),t.prop("disabled",!1),g()}))}),k.data("running")&&g();var x=e("#wpo-analytics-hidden-content");return e("#wpo_enable_analytics").on("change",function(){x.css("display",e(this).prop("checked")?"block":"none")}),this},l.getFiles=function(){if(this.enabled){var e={stamp:(new Date).getTime()};a("get_minify_cached_files",e,function(e){l.updateFilesLists(e),l.updateStats(e)}),o&&setTimeout(l.getFiles.bind(this),o)}},l.updateFilesLists=function(t){if(null!==t){var i=[];t.js.length>0&&e(t.js).each(function(){i.push(this.uid),0==e("#"+this.uid).length&&e("#wpo_min_jsprocessed ul.processed").append('\t\t\t\t\t<li id="'+this.uid+'">\t\t\t\t\t\t<span class="filename"><a href="'+this.file_url+'" target="_blank">'+this.filename+"</a> ("+this.fsize+')</span>\t\t\t\t\t\t<a href="#" class="log">'+wpoptimize.show_information+'</a>\t\t\t\t\t\t<a href="#" class="delete-file" data-filename="'+this.filename+'">'+wpoptimize.delete_file+'</a>\t\t\t\t\t\t<div class="hidden save_notice">\t\t\t\t\t\t\t<p>'+wpoptimize.added_notice+'</p>\t\t\t\t\t\t\t<p><button class="button button-primary save-exclusions">'+wpoptimize.save_notice+'</button></p>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="hidden wpo_min_log">'+this.log+"</div>\t\t\t\t\t</li>\t\t\t\t")}),e("#wpo_min_jsprocessed ul.processed .no-files-yet").toggle(!t.js.length),t.css.length>0&&e(t.css).each(function(){i.push(this.uid),0==e("#"+this.uid).length&&e("#wpo_min_cssprocessed ul.processed").append('\t\t\t\t\t<li id="'+this.uid+'">\t\t\t\t\t\t<span class="filename"><a href="'+this.file_url+'" target="_blank">'+this.filename+"</a> ("+this.fsize+')</span>\t\t\t\t\t\t<a href="#" class="log">'+wpoptimize.show_information+'</a>\t\t\t\t\t\t<a href="#" class="delete-file" data-filename="'+this.filename+'">'+wpoptimize.delete_file+'</a>\t\t\t\t\t\t<div class="hidden save_notice">\t\t\t\t\t\t\t<p>'+wpoptimize.added_to_list+'</p>\t\t\t\t\t\t\t<p><button class="button button-primary save-exclusions">'+wpoptimize.save_notice+'</button></p>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="hidden wpo_min_log">'+this.log+"</div>\t\t\t\t\t</li>\t\t\t\t")}),e("#wpo_min_cssprocessed ul.processed .no-files-yet").toggle(!t.css.length),e("#wpo_min_jsprocessed ul.processed > li, #wpo_min_cssprocessed ul.processed > li").each(function(){-1==jQuery.inArray(e(this).attr("id"),i)&&(e(this).is(".no-files-yet")||e(this).remove())})}},l.updateStats=function(t){t.cachesize.length>0&&(e("#wpo_min_cache_size").html(this.enabled?t.cachesize:wpoptimize.no_minified_assets),e("#wpo_min_cache_total_size").html(this.enabled?t.total_cache_size:wpoptimize.no_minified_assets),e("#wpo_min_cache_time").html(this.enabled?t.cacheTime:"-"),e("#wpo_min_cache_path").html(t.cachePath))},n.minify_settings=function(){var i=e('[data-whichpage="wpo_minify"] .wp-optimize-nav-tab-contents form'),n={};return i.each(function(){var i=e(this);n=Object.assign(n,t(i))}),n},n.minify=l}(jQuery);